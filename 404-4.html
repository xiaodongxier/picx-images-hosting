<!doctype html>
<html lang="zh-CN">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>请稍等，图片正在加载</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#6366F1', // 靛蓝色
            secondary: '#10B981', // 绿色
            accent: '#F472B6', // 粉色
            dark: '#0F172A',
            light: '#F8FAFC'
          },
          fontFamily: {
            inter: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>

  <style type="text/tailwindcss">
    @layer utilities {
      .text-shadow-glow {
        text-shadow: 0 0 10px currentColor, 0 0 20px currentColor, 0 0 30px currentColor;
      }
      .text-gradient {
        background-clip: text;
        -webkit-background-clip: text;
        color: transparent;
      }
      .animate-float {
        animation: float 6s ease-in-out infinite;
      }
      .animate-bounce-slow {
        animation: bounce 3s infinite;
      }
      .backdrop-blur {
        backdrop-filter: blur(8px);
      }
      .game-shadow {
        box-shadow: 0 0 30px rgba(99, 102, 241, 0.2);
      }
    }
  </style>
</head>

<body
  class="m-0 bg-gradient-to-br from-dark via-slate-900 to-slate-800 text-light font-inter min-h-screen flex flex-col items-center justify-center overflow-hidden relative">
  <!-- 背景装饰元素 -->
  <div class="absolute inset-0 overflow-hidden pointer-events-none">
    <div class="absolute top-1/4 -left-20 w-96 h-96 bg-primary/20 rounded-full blur-3xl animate-pulse"></div>
    <div class="absolute bottom-1/3 -right-20 w-96 h-96 bg-accent/20 rounded-full blur-3xl animate-pulse"
      style="animation-delay: 2s;"></div>
  </div>

  <!-- 主内容 -->
  <div class="relative z-10 text-center px-4 max-w-3xl w-full">
    <div
      class="inline-block mb-6 p-5 rounded-full bg-white/10 backdrop-blur border border-white/20 animate-float shadow-lg shadow-primary/20">
      <i class="fa fa-picture-o text-5xl text-gradient bg-gradient-to-r from-primary via-accent to-secondary"></i>
    </div>

    <h1
      class="text-[clamp(1.5rem,4vw,2.5rem)] font-bold mb-4 tracking-tight text-gradient bg-gradient-to-r from-primary via-accent to-secondary transition-all duration-1000">
      图片还在路上 <span class="inline-block animate-bounce">🚚💨</span>
    </h1>

    <div id="timer"
      class="text-[clamp(2.5rem,8vw,5rem)] font-extrabold mb-4 text-primary text-shadow-glow transition-all duration-500 transform hover:scale-110 hover:text-accent">
      60</div>

    <div id="msg"
      class="text-[clamp(1rem,3vw,1.25rem)] text-slate-300 mb-6 min-h-[2rem] transition-all duration-700 ease-in-out px-4 py-2 rounded-lg bg-white/5 backdrop-blur">
      等待时来玩个小游戏吧！点击气球得分～
    </div>

    <!-- 游戏区域 -->
    <div class="relative w-full mb-6">
      <canvas id="gameCanvas"
        class="w-full h-80 rounded-2xl bg-white/5 backdrop-blur border border-white/10 game-shadow"></canvas>

      <!-- 游戏分数显示 -->
      <div
        class="absolute top-4 right-4 bg-dark/70 backdrop-blur px-3 py-1 rounded-full text-lg font-bold border border-white/10">
        得分: <span id="score" class="text-accent">0</span>
      </div>

      <!-- 游戏说明 -->
      <div
        class="absolute top-4 left-4 bg-dark/70 backdrop-blur px-3 py-1 rounded-full text-sm border border-white/10 hidden sm:block">
        <i class="fa fa-hand-pointer-o mr-1"></i> 点击气球得分
      </div>
    </div>

    <div id="musicTip"
      class="text-sm text-slate-400 flex items-center justify-center gap-2 group cursor-pointer hover:text-primary transition-colors duration-300">
      <i class="fa fa-music animate-pulse"></i>
      <span>点击页面启动背景音乐</span>
    </div>
  </div>

  <!-- 装饰性进度条 -->
  <div class="absolute bottom-0 left-0 right-0 h-2 bg-white/10 overflow-hidden">
    <div id="progressBar"
      class="h-full bg-gradient-to-r from-primary via-accent to-secondary w-0 transition-all duration-1000"></div>
  </div>

  <!-- 背景音乐 -->
  <audio id="bgm" src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3" loop preload="auto"></audio>

  <!-- 游戏音效 -->
  <audio id="popSound" src="https://assets.mixkit.co/sfx/preview/mixkit-bubble-pop-up-alert-notification-2358.mp3"
    preload="auto"></audio>
  <audio id="missSound" src="https://assets.mixkit.co/sfx/preview/mixkit-unlocking-5633.mp3" preload="auto"></audio>

  <script>
    // 倒计时功能
    let sec = 60;
    const timerEl = document.getElementById('timer');
    const msgEl = document.getElementById('msg');
    const progressBar = document.getElementById('progressBar');
    const bgm = document.getElementById('bgm');
    const popSound = document.getElementById('popSound');
    const missSound = document.getElementById('missSound');
    let gameActive = true;

    const messages = [
      "🎈 点击气球得分！",
      "💥 气球爆炸越多，分数越高",
      "⏳ 时间不多了，加油！",
      "🎯 瞄准那些彩色气球",
      "🌟 连击可以获得更高分数",
      "🌈 加载进度: " + Math.round(((60 - sec) / 60) * 100) + "%",
      "🎮 游戏结束后自动刷新页面"
    ];

    // 更新进度条和进度消息
    function updateProgress() {
      const progress = ((60 - sec) / 60) * 100;
      progressBar.style.width = `${progress}%`;

      // 更新进度消息
      messages[5] = "🌈 加载进度: " + Math.round(progress) + "%";
    }

    // 倒计时逻辑
    function tick() {
      // 添加数字变化动画
      timerEl.classList.add('scale-110', 'opacity-70');
      setTimeout(() => {
        timerEl.classList.remove('scale-110', 'opacity-70');
      }, 300);

      timerEl.textContent = sec;
      updateProgress();

      // 随机更换提示信息
      if (sec % 8 === 0 && sec > 0) {
        msgEl.style.opacity = '0';
        msgEl.style.transform = 'translateY(10px)';
        setTimeout(() => {
          msgEl.textContent = messages[Math.floor(Math.random() * messages.length)];
          msgEl.style.opacity = '1';
          msgEl.style.transform = 'translateY(0)';
        }, 300);
      }

      // 最后10秒提示
      if (sec === 10) {
        msgEl.textContent = "⏰ 只剩10秒了！";
        msgEl.classList.add('text-accent');
      }

      if (sec > 0) {
        sec--;
        setTimeout(tick, 1000);
      } else {
        endGame();
        msgEl.textContent = "✅ 图片准备就绪，正在刷新…";
        msgEl.classList.remove('text-accent');
        setTimeout(() => {
          // 添加页面过渡效果
          document.body.classList.add('opacity-0', 'transition-opacity', 'duration-1000');
          setTimeout(() => location.reload(), 1000);
        }, 2000);
      }
    }
    tick();

    // 气球游戏实现
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    let score = 0;
    const scoreEl = document.getElementById('score');
    let balloons = [];
    let explosions = [];
    let combo = 0;
    let lastPopTime = 0;

    // 设置Canvas尺寸为响应式
    function resizeCanvas() {
      const container = canvas.parentElement;
      canvas.width = container.clientWidth;
      canvas.height = container.clientHeight;
    }

    // 初始化尺寸并监听窗口变化
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);

    // 气球类
    class Balloon {
      constructor() {
        this.reset();
      }

      reset() {
        // 随机位置（左右两边）
        this.x = Math.random() > 0.5 ?
          Math.random() * canvas.width * 0.3 + canvas.width * 0.7 :
          Math.random() * canvas.width * 0.3;

        this.y = canvas.height + Math.random() * 50;
        this.size = Math.random() * 20 + 30; // 30-50
        this.speed = Math.random() * 1 + 0.5; // 0.5-1.5
        this.color = this.getRandomColor();
        this.popped = false;
        this.pulse = Math.random() * Math.PI * 2;
        this.pulseSpeed = Math.random() * 0.05 + 0.02;
        this.value = Math.floor((50 - this.size) / 5) + 1; // 越大的气球分值越低
        this.rotation = Math.random() * 0.4 - 0.2; // 轻微旋转
        this.rotationSpeed = Math.random() * 0.02 - 0.01;
      }

      getRandomColor() {
        const colors = [
          '#6366F1', // primary
          '#10B981', // secondary
          '#F472B6', // accent
          '#F59E0B', // amber
          '#EF4444'  // red
        ];
        return colors[Math.floor(Math.random() * colors.length)];
      }

      update() {
        // 上升
        this.y -= this.speed;

        // 左右摇摆
        this.x += Math.sin(this.y * 0.02) * 0.5;

        // 呼吸效果
        this.pulse += this.pulseSpeed;

        // 旋转
        this.rotation += this.rotationSpeed;

        // 超出屏幕顶部
        if (this.y + this.size < 0) {
          if (!this.popped) {
            // 未点击消失，扣分
            score = Math.max(0, score - 5);
            scoreEl.textContent = score;
            playSound(missSound);
            combo = 0;
          }
          this.reset();
        }
      }

      draw() {
        if (this.popped) return;

        const pulseFactor = Math.sin(this.pulse) * 0.05 + 1;
        const currentSize = this.size * pulseFactor;

        // 保存当前状态
        ctx.save();

        // 移动到气球位置
        ctx.translate(this.x, this.y);

        // 旋转
        ctx.rotate(this.rotation);

        // 绘制气球
        ctx.beginPath();
        ctx.arc(0, 0, currentSize, 0, Math.PI * 2);
        ctx.fillStyle = this.color;
        ctx.fill();

        // 高光效果
        const gradient = ctx.createRadialGradient(
          -currentSize * 0.3, -currentSize * 0.3, 0,
          0, 0, currentSize
        );
        gradient.addColorStop(0, 'rgba(255, 255, 255, 0.6)');
        gradient.addColorStop(1, 'rgba(255, 255, 255, 0)');
        ctx.beginPath();
        ctx.arc(0, 0, currentSize, 0, Math.PI * 2);
        ctx.fillStyle = gradient;
        ctx.fill();

        // 绘制绳子
        ctx.beginPath();
        ctx.moveTo(0, currentSize);
        ctx.lineTo(0, currentSize + 15);
        ctx.strokeStyle = '#fff';
        ctx.lineWidth = 2;
        ctx.stroke();

        // 恢复状态
        ctx.restore();
      }

      // 检查是否点击了气球
      checkClick(x, y) {
        const dx = x - this.x;
        const dy = y - this.y;
        const distance = Math.sqrt(dx * dx + dy * dy);

        if (distance < this.size && !this.popped) {
          this.popped = true;
          this.pop();
          return true;
        }
        return false;
      }

      // 气球爆炸
      pop() {
        // 计算连击
        const now = Date.now();
        if (now - lastPopTime < 1000) {
          combo++;
        } else {
          combo = 1;
        }
        lastPopTime = now;

        // 计算得分，连击有加成
        const comboBonus = Math.min(combo, 5); // 最大5倍连击
        const points = this.value * comboBonus;
        score += points;
        scoreEl.textContent = score;

        // 播放音效
        playSound(popSound);

        // 创建爆炸效果
        explosions.push(new Explosion(this.x, this.y, this.size, this.color));

        // 显示得分
        if (points > 1) {
          showFloatingText(this.x, this.y, `+${points}` + (comboBonus > 1 ? ` x${comboBonus}` : ''));
        }
      }
    }

    // 爆炸效果类
    class Explosion {
      constructor(x, y, size, color) {
        this.x = x;
        this.y = y;
        this.particles = [];
        this.life = 30;

        // 创建爆炸粒子
        const particleCount = Math.floor(size / 3);
        for (let i = 0; i < particleCount; i++) {
          this.particles.push({
            x: x,
            y: y,
            size: Math.random() * 4 + 2,
            speedX: Math.random() * 6 - 3,
            speedY: Math.random() * 6 - 3,
            color: color,
            alpha: 1
          });
        }
      }

      update() {
        this.life--;
        for (let i = 0; i < this.particles.length; i++) {
          const p = this.particles[i];
          p.x += p.speedX;
          p.y += p.speedY;
          p.alpha = this.life / 30;
          p.speedY += 0.1; // 重力效果
          p.size *= 0.95;
        }
      }

      draw() {
        for (let i = 0; i < this.particles.length; i++) {
          const p = this.particles[i];
          ctx.save();
          ctx.globalAlpha = p.alpha;
          ctx.fillStyle = p.color;
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
          ctx.fill();
          ctx.restore();
        }
      }
    }

    // 浮动文字效果
    class FloatingText {
      constructor(x, y, text) {
        this.x = x;
        this.y = y;
        this.text = text;
        this.life = 30;
        this.size = 16;
        this.color = '#F472B6';
      }

      update() {
        this.life--;
        this.y -= 1;
        this.size *= 0.98;
      }

      draw() {
        const alpha = this.life / 30;
        ctx.save();
        ctx.globalAlpha = alpha;
        ctx.fillStyle = this.color;
        ctx.font = `${this.size}px Inter, sans-serif`;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(this.text, this.x, this.y);
        ctx.restore();
      }
    }

    // 浮动文字数组
    let floatingTexts = [];

    // 创建浮动文字
    function showFloatingText(x, y, text) {
      floatingTexts.push(new FloatingText(x, y, text));
    }

    // 初始化气球
    function initBalloons() {
      balloons = [];
      // 根据屏幕大小决定气球数量
      const balloonCount = Math.floor(canvas.width / 150) + 3;
      for (let i = 0; i < balloonCount; i++) {
        balloons.push(new Balloon());
      }
    }

    // 处理点击
    function handleClick(e) {
      if (!gameActive) return;

      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;

      // 检查是否点击了气球
      let popped = false;
      for (let i = 0; i < balloons.length; i++) {
        if (balloons[i].checkClick(x, y)) {
          popped = true;
          break;
        }
      }

      // 如果没点中气球，轻微扣分
      if (!popped) {
        score = Math.max(0, score - 1);
        scoreEl.textContent = score;
        combo = 0;
      }
    }

    // 处理触摸
    function handleTouch(e) {
      e.preventDefault();
      if (!gameActive) return;

      const rect = canvas.getBoundingClientRect();
      const touch = e.touches[0];
      const x = touch.clientX - rect.left;
      const y = touch.clientY - rect.top;

      // 检查是否点击了气球
      for (let i = 0; i < balloons.length; i++) {
        if (balloons[i].checkClick(x, y)) {
          break;
        }
      }
    }

    // 游戏循环
    function gameLoop() {
      // 清空画布
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // 绘制背景网格
      drawGrid();

      // 更新和绘制气球
      for (let i = 0; i < balloons.length; i++) {
        balloons[i].update();
        balloons[i].draw();
      }

      // 更新和绘制爆炸效果
      for (let i = 0; i < explosions.length; i++) {
        explosions[i].update();
        explosions[i].draw();

        // 移除已结束的爆炸
        if (explosions[i].life <= 0) {
          explosions.splice(i, 1);
          i--;
        }
      }

      // 更新和绘制浮动文字
      for (let i = 0; i < floatingTexts.length; i++) {
        floatingTexts[i].update();
        floatingTexts[i].draw();

        // 移除已结束的文字
        if (floatingTexts[i].life <= 0) {
          floatingTexts.splice(i, 1);
          i--;
        }
      }

      // 显示连击
      if (combo > 1) {
        ctx.save();
        ctx.fillStyle = '#F59E0B';
        ctx.font = '20px Inter, sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText(`连击 x${combo}`, canvas.width / 2, 40);
        ctx.restore();
      }

      if (gameActive) {
        requestAnimationFrame(gameLoop);
      }
    }

    // 绘制背景网格
    function drawGrid() {
      const gridSize = 40;
      const time = Date.now() * 0.0005;

      ctx.strokeStyle = 'rgba(99, 102, 241, 0.07)';
      ctx.lineWidth = 1;

      // 水平网格线，随时间移动
      for (let y = 0; y < canvas.height; y += gridSize) {
        const offset = Math.sin(time + y * 0.01) * 10;
        ctx.beginPath();
        ctx.moveTo(0 + offset, y);
        ctx.lineTo(canvas.width + offset, y);
        ctx.stroke();
      }

      // 垂直网格线，随时间移动
      for (let x = 0; x < canvas.width; x += gridSize) {
        const offset = Math.cos(time + x * 0.01) * 10;
        ctx.beginPath();
        ctx.moveTo(x, 0 + offset);
        ctx.lineTo(x, canvas.height + offset);
        ctx.stroke();
      }
    }

    // 结束游戏
    function endGame() {
      gameActive = false;

      // 显示最终得分
      ctx.save();
      ctx.fillStyle = 'rgba(15, 23, 42, 0.8)';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      ctx.fillStyle = '#fff';
      ctx.font = 'bold 24px Inter, sans-serif';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText('游戏结束！', canvas.width / 2, canvas.height / 2 - 30);

      ctx.font = 'bold 36px Inter, sans-serif';
      ctx.fillStyle = '#F472B6';
      ctx.fillText(`最终得分: ${score}`, canvas.width / 2, canvas.height / 2 + 10);

      ctx.font = '16px Inter, sans-serif';
      ctx.fillStyle = '#ccc';
      ctx.fillText('即将刷新页面...', canvas.width / 2, canvas.height / 2 + 60);
      ctx.restore();
    }

    // 播放音效
    function playSound(sound) {
      // 重置音效并播放
      sound.currentTime = 0;
      sound.play().catch(e => {
        // 忽略播放错误，通常是因为需要用户交互
      });
    }

    // 音乐播放功能
    function playMusic() {
      bgm.play().then(() => {
        document.getElementById('musicTip').innerHTML = '<i class="fa fa-music text-secondary"></i><span>正在播放背景音乐...</span>';
      }).catch(() => {
        // 播放失败时不做处理
      });
      document.removeEventListener('click', playMusic);
      document.getElementById('musicTip').removeEventListener('click', playMusic);
    }

    // 事件监听
    canvas.addEventListener('click', handleClick);
    canvas.addEventListener('touchstart', handleTouch, { passive: false });
    window.addEventListener('click', playMusic);
    document.getElementById('musicTip').addEventListener('click', playMusic);

    // 初始化游戏
    initBalloons();
    gameLoop();

    // 点击波纹效果
    document.addEventListener('click', (e) => {
      const ripple = document.createElement('div');
      ripple.className = 'fixed rounded-full bg-primary/20 transform -translate-x-1/2 -translate-y-1/2 pointer-events-none';
      ripple.style.left = `${e.clientX}px`;
      ripple.style.top = `${e.clientY}px`;
      ripple.style.width = '0';
      ripple.style.height = '0';
      ripple.style.animation = 'ripple 1.5s ease-out forwards';
      document.body.appendChild(ripple);

      setTimeout(() => ripple.remove(), 1500);
    });

    // 添加波纹动画样式
    const style = document.createElement('style');
    style.textContent = `
      @keyframes ripple {
        0% { width: 0; height: 0; opacity: 1; }
        100% { width: 300px; height: 300px; opacity: 0; }
      }
    `;
    document.head.appendChild(style);
  </script>
</body>

</html>